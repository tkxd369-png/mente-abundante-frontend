 <!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Truth Path — Verificación</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- ✅ Cambia aquí el estilo:
       styles-blackgold.css  o  styles-ivorygold.css -->
  <link rel="stylesheet" href="styles-ivorygold.css" />
</head>

<body class="tp-body">
  <div class="tp-shell">

    <!-- Topbar -->
    <header class="tp-topbar">
      <div class="tp-brand">
        <div class="tp-eyebrow">TMK · The Truth Path</div>
        <div class="tp-title">The Truth Path</div>
      </div>

      <a class="tp-link" href="../dashboard.html">Dashboard</a>
    </header>

    <!-- Card -->
    <main class="tp-card">
      <div class="tp-sticky">
        <div class="tp-kicker">Verification</div>
        <div class="tp-meta">7 preguntas</div>
      </div>

      <section class="tp-content">
        <div class="tp-note">
          <div class="tp-note-title">Un espacio personal</div>
          <p>
            “Mas tú, cuando ores, entra en tu aposento y cerrada la puerta…”
            <span class="tp-aside">(Inspiración: silencio, claridad y conexión real.)</span>
          </p>
          <p class="tp-muted">
            No se trata de religión, ni dogmas de hombres, ni misticismos, ni manipulación.
            Se trata de encontrar la verdad más allá del ruido.
          </p>
        </div>

        <hr class="tp-divider">

        <form id="quizForm" class="tp-form" novalidate>
          <p class="tp-instructions">Elige la opción que mejor refleja el espíritu del libro.</p>

          <!-- Q1 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>1)</strong> La verdadera abundancia se reconoce principalmente por:</p>
            <label class="tp-opt"><input type="radio" name="q1" value="A"> Tener más lujos que otros</label>
            <label class="tp-opt"><input type="radio" name="q1" value="B"> No sentir miedo nunca</label>
            <label class="tp-opt"><input type="radio" name="q1" value="C"> Paz, claridad y alineación interior que sostiene lo externo</label>
            <label class="tp-opt"><input type="radio" name="q1" value="D"> Lograr reconocimiento público</label>
          </div>

          <!-- Q2 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>2)</strong> “Ser una fuente” significa:</p>
            <label class="tp-opt"><input type="radio" name="q2" value="A"> Depender de otros para estar bien</label>
            <label class="tp-opt"><input type="radio" name="q2" value="B"> Controlar a los demás para que cambien</label>
            <label class="tp-opt"><input type="radio" name="q2" value="C"> Tomar responsabilidad y generar valor desde tu interior hacia afuera</label>
            <label class="tp-opt"><input type="radio" name="q2" value="D"> Evitar todo riesgo para no fallar</label>
          </div>

          <!-- Q3 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>3)</strong> La ley de causa y efecto se aplica así:</p>
            <label class="tp-opt"><input type="radio" name="q3" value="A"> El destino ya está escrito</label>
            <label class="tp-opt"><input type="radio" name="q3" value="B"> Lo que piensas/dices/haces siembra dirección y produce resultados</label>
            <label class="tp-opt"><input type="radio" name="q3" value="C"> La suerte define lo que recibes</label>
            <label class="tp-opt"><input type="radio" name="q3" value="D"> Solo el trabajo físico produce resultados</label>
          </div>

          <!-- Q4 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>4)</strong> “Sembrar” significa:</p>
            <label class="tp-opt"><input type="radio" name="q4" value="A"> Dar únicamente cuando sobra</label>
            <label class="tp-opt"><input type="radio" name="q4" value="B"> Acción intencional que lleva vida/valor, aunque sea pequeña</label>
            <label class="tp-opt"><input type="radio" name="q4" value="C"> Esperar el momento perfecto</label>
            <label class="tp-opt"><input type="radio" name="q4" value="D"> Probar al azar</label>
          </div>

          <!-- Q5 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>5)</strong> La gratitud cumple este papel:</p>
            <label class="tp-opt"><input type="radio" name="q5" value="A"> Negar la realidad</label>
            <label class="tp-opt"><input type="radio" name="q5" value="B"> Alinear, ver con claridad y sostener reconocimiento en el camino</label>
            <label class="tp-opt"><input type="radio" name="q5" value="C"> Convencer al mundo que eres bueno</label>
            <label class="tp-opt"><input type="radio" name="q5" value="D"> Agradecer solo cuando todo sale perfecto</label>
          </div>

          <!-- Q6 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>6)</strong> Compartir TMK fiel al libro es:</p>
            <label class="tp-opt"><input type="radio" name="q6" value="A"> Presionar a todos</label>
            <label class="tp-opt"><input type="radio" name="q6" value="B"> Vender por necesidad</label>
            <label class="tp-opt"><input type="radio" name="q6" value="C"> Recomendar solo si sientes valor real para alguien</label>
            <label class="tp-opt"><input type="radio" name="q6" value="D"> Publicar por obligación</label>
          </div>

          <!-- Q7 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>7)</strong> “La Verdad que libera” es:</p>
            <label class="tp-opt"><input type="radio" name="q7" value="A"> Ideología para discutir</label>
            <label class="tp-opt"><input type="radio" name="q7" value="B"> Concepto religioso para imponerse</label>
            <label class="tp-opt"><input type="radio" name="q7" value="C"> Comprensión que se vuelve vida práctica y ordena decisiones desde adentro</label>
            <label class="tp-opt"><input type="radio" name="q7" value="D"> Secreto exclusivo</label>
          </div>

          <div id="quizMsg" class="tp-msg" style="display:none;"></div>

          <div class="tp-actions">
            <button id="submitBtn" class="tp-btn tp-btn-primary" type="submit">Verify & Continue</button>
            <button id="resetBtn" class="tp-btn" type="button" style="display:none;">Retry</button>
          </div>
        </form>

        <div id="successBox" class="tp-success" style="display:none;">
          <div class="tp-note">
            <div class="tp-note-title">Unlocked</div>
            <p>✅ Verificación completada. <span class="tp-aside">The Truth Path</span> ha sido desbloqueado.</p>
          </div>

          <div class="tp-actions">
            <button class="tp-btn tp-btn-primary" type="button" onclick="window.location.href='./index.html'">
              Continue →
            </button>
          </div>
        </div>

      </section>
    </main>

  </div>

  <script>
    (function () {
      const ANSWERS = { q1:"C", q2:"C", q3:"B", q4:"B", q5:"B", q6:"C", q7:"C" };
      const TOTAL = 7;
      const PASS  = 6;

      const form = document.getElementById("quizForm");
      const msg = document.getElementById("quizMsg");
      const submitBtn = document.getElementById("submitBtn");
      const resetBtn = document.getElementById("resetBtn");
      const successBox = document.getElementById("successBox");

      function showMsg(html, ok){
        msg.style.display = "block";
        msg.classList.toggle("ok", !!ok);
        msg.classList.toggle("bad", !ok);
        msg.innerHTML = html;
      }

      function setLocked(lock){
        submitBtn.disabled = lock;
        submitBtn.style.opacity = lock ? "0.7" : "1";
      }

      function scoreQuiz(){
        let score = 0;
        const fd = new FormData(form);
        Object.keys(ANSWERS).forEach((q) => {
          const chosen = (fd.get(q) || "").toString();
          if (chosen && chosen === ANSWERS[q]) score++;
        });
        return score;
      }

      async function submitToBackend(payload){
        const url = "/api/quiz/submit";
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error("backend not available");
        return await res.json();
      }

      function fallbackUnlock(score){
        try{
          localStorage.setItem("tmk_book_completed", "true");
          localStorage.setItem("tmk_truth_path_unlocked", "true");
          localStorage.setItem("tmk_quiz_score", String(score));
        }catch(e){}
      }

      resetBtn.addEventListener("click", function(){
        form.reset();
        msg.style.display = "none";
        resetBtn.style.display = "none";
        successBox.style.display = "none";
        setLocked(false);
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      form.addEventListener("submit", async function(e){
        e.preventDefault();
        const fd = new FormData(form);

        for (let i=1;i<=TOTAL;i++){
          if (!fd.get("q"+i)){
            showMsg("⚠️ Responde todas las preguntas para continuar.", false);
            return;
          }
        }

        const score = scoreQuiz();
        if (score < PASS){
          resetBtn.style.display = "inline-flex";
          showMsg(`⚠️ Casi. Resultado: <strong>${score}/${TOTAL}</strong>. Relee con calma donde sentiste resistencia y vuelve a intentar.`, false);
          return;
        }

        showMsg(`✅ Resultado: <strong>${score}/${TOTAL}</strong>. Verificación completada.`, true);
        setLocked(true);

        try{
          await submitToBackend({ kind:"tmk_truth_path_quiz", score, total:TOTAL, passed:true });
        }catch(err){
          fallbackUnlock(score);
        }

        msg.style.display = "none";
        successBox.style.display = "block";
        successBox.scrollIntoView({ behavior:"smooth", block:"start" });
      });
    })();
  </script>
</body>
</html>
