<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Truth Path — Verification</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles-ivorygold.css" />
</head>

<body class="tp-body">
  <div class="tp-shell">

    <!-- Topbar -->
    <header class="tp-topbar">
      <div class="tp-brand">
        <div class="tp-eyebrow">TMK · The Truth Path</div>
        <div class="tp-title">The Truth Path</div>
      </div>

      <a class="tp-link" href="../dashboard.html">Dashboard</a>
    </header>

    <!-- Card -->
    <main class="tp-card">
      <div class="tp-sticky">
        <div class="tp-kicker">Verification</div>
        <div class="tp-meta">7 questions</div>
      </div>

      <section class="tp-content">
        <div class="tp-note">
          <div class="tp-note-title">A private space</div>
          <p>
            “But when you pray, go into your room, close the door…” 
            <span class="tp-aside">(Inspiration: silence, clarity, and a real connection.)</span>
          </p>
          <p class="tp-muted">
            This is not about religion, man-made dogmas, mysticism, or manipulation.
            It’s about finding truth beyond the noise.
          </p>
        </div>

        <hr class="tp-divider">

        <form id="quizForm" class="tp-form" novalidate>
          <p class="tp-instructions">Choose the option that best reflects the spirit of the book.</p>

          <!-- Q1 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>1)</strong> True abundance is primarily recognized by:</p>
            <label class="tp-opt"><input type="radio" name="q1" value="A"> Having more luxuries than others</label>
            <label class="tp-opt"><input type="radio" name="q1" value="B"> Never feeling fear</label>
            <label class="tp-opt"><input type="radio" name="q1" value="C"> Inner peace, clarity, and alignment that can sustain the outer life</label>
            <label class="tp-opt"><input type="radio" name="q1" value="D"> Public recognition</label>
          </div>

          <!-- Q2 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>2)</strong> “Being a source” means:</p>
            <label class="tp-opt"><input type="radio" name="q2" value="A"> Depending on others to feel secure</label>
            <label class="tp-opt"><input type="radio" name="q2" value="B"> Controlling people so they change</label>
            <label class="tp-opt"><input type="radio" name="q2" value="C"> Taking responsibility and generating value from the inside out</label>
            <label class="tp-opt"><input type="radio" name="q2" value="D"> Avoiding all risk to never fail</label>
          </div>

          <!-- Q3 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>3)</strong> Cause and effect works like this in the book:</p>
            <label class="tp-opt"><input type="radio" name="q3" value="A"> Your destiny is fixed and cannot change</label>
            <label class="tp-opt"><input type="radio" name="q3" value="B"> What you think, speak, and do plants direction and produces results</label>
            <label class="tp-opt"><input type="radio" name="q3" value="C"> Luck decides what you receive</label>
            <label class="tp-opt"><input type="radio" name="q3" value="D"> Only physical work creates results</label>
          </div>

          <!-- Q4 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>4)</strong> “Planting a seed” means:</p>
            <label class="tp-opt"><input type="radio" name="q4" value="A"> Giving only when you have extra</label>
            <label class="tp-opt"><input type="radio" name="q4" value="B"> Taking an intentional action that carries life/value—even small—with clear direction</label>
            <label class="tp-opt"><input type="radio" name="q4" value="C"> Waiting for the perfect moment</label>
            <label class="tp-opt"><input type="radio" name="q4" value="D"> Trying random things to see what works</label>
          </div>

          <!-- Q5 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>5)</strong> Gratitude plays this role:</p>
            <label class="tp-opt"><input type="radio" name="q5" value="A"> Denying reality</label>
            <label class="tp-opt"><input type="radio" name="q5" value="B"> Keeping you aligned, seeing clearly, and sustaining recognition along the way</label>
            <label class="tp-opt"><input type="radio" name="q5" value="C"> Proving you’re a good person</label>
            <label class="tp-opt"><input type="radio" name="q5" value="D"> Being grateful only when everything goes perfectly</label>
          </div>

          <!-- Q6 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>6)</strong> Sharing TMK in the spirit of the book is:</p>
            <label class="tp-opt"><input type="radio" name="q6" value="A"> Pressuring everyone to join</label>
            <label class="tp-opt"><input type="radio" name="q6" value="B"> Selling out of desperation</label>
            <label class="tp-opt"><input type="radio" name="q6" value="C"> Recommending only if you genuinely believe it brings real value to someone</label>
            <label class="tp-opt"><input type="radio" name="q6" value="D"> Posting every day out of obligation</label>
          </div>

          <!-- Q7 -->
          <div class="tp-q">
            <p class="tp-q-title"><strong>7)</strong> “The truth that sets you free” refers to:</p>
            <label class="tp-opt"><input type="radio" name="q7" value="A"> An ideology to debate</label>
            <label class="tp-opt"><input type="radio" name="q7" value="B"> A religious concept to impose</label>
            <label class="tp-opt"><input type="radio" name="q7" value="C"> An understanding that becomes practical life and reorders decisions from within</label>
            <label class="tp-opt"><input type="radio" name="q7" value="D"> A secret for only a few</label>
          </div>

          <div id="quizMsg" class="tp-msg" style="display:none;"></div>

          <div class="tp-actions">
            <button id="submitBtn" class="tp-btn tp-btn-primary" type="submit">Verify & Continue</button>
            <button id="resetBtn" class="tp-btn" type="button" style="display:none;">Retry</button>
          </div>
        </form>

        <div id="successBox" class="tp-success" style="display:none;">
          <div class="tp-note">
            <div class="tp-note-title">Unlocked</div>
            <p>✅ Verification complete. <span class="tp-aside">The Truth Path</span> is now unlocked.</p>
          </div>

          <div class="tp-actions">
            <button class="tp-btn tp-btn-primary" type="button" onclick="window.location.href='../dashboard.html'">
              Go to Dashboard →
            </button>
          </div>
        </div>

      </section>
    </main>

  </div>

  <script>
    (function () {
      const ANSWERS = { q1:"C", q2:"C", q3:"B", q4:"B", q5:"B", q6:"C", q7:"C" };
      const TOTAL = 7;
      const PASS  = 6;

      const form = document.getElementById("quizForm");
      const msg = document.getElementById("quizMsg");
      const submitBtn = document.getElementById("submitBtn");
      const resetBtn = document.getElementById("resetBtn");
      const successBox = document.getElementById("successBox");

      function showMsg(html, ok){
        msg.style.display = "block";
        msg.classList.toggle("ok", !!ok);
        msg.classList.toggle("bad", !ok);
        msg.innerHTML = html;
      }

      function setLocked(lock){
        submitBtn.disabled = lock;
        submitBtn.style.opacity = lock ? "0.7" : "1";
      }

      function scoreQuiz(){
        let score = 0;
        const fd = new FormData(form);
        Object.keys(ANSWERS).forEach((q) => {
          const chosen = (fd.get(q) || "").toString();
          if (chosen && chosen === ANSWERS[q]) score++;
        });
        return score;
      }

      async function submitToBackend(payload){
        const url = "/api/quiz/submit"; // placeholder
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error("backend not available");
        return await res.json();
      }

      function fallbackUnlock(score){
        try{
          localStorage.setItem("tmk_book_completed", "true");
          localStorage.setItem("tmk_truth_path_unlocked", "true");
          localStorage.setItem("tmk_quiz_score", String(score));
        }catch(e){}
      }

      resetBtn.addEventListener("click", function(){
        form.reset();
        msg.style.display = "none";
        resetBtn.style.display = "none";
        successBox.style.display = "none";
        setLocked(false);
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      form.addEventListener("submit", async function(e){
        e.preventDefault();
        const fd = new FormData(form);

        for (let i=1;i<=TOTAL;i++){
          if (!fd.get("q"+i)){
            showMsg("⚠️ Please answer all questions to continue.", false);
            return;
          }
        }

        const score = scoreQuiz();
        if (score < PASS){
          resetBtn.style.display = "inline-flex";
          showMsg(`⚠️ Almost. Score: <strong>${score}/${TOTAL}</strong>. Revisit the chapters where you felt resistance and try again.`, false);
          return;
        }

        showMsg(`✅ Score: <strong>${score}/${TOTAL}</strong>. Verification complete.`, true);
        setLocked(true);

        try{
          await submitToBackend({ kind:"tmk_truth_path_quiz", score, total:TOTAL, passed:true, lang:"en" });
        }catch(err){
          fallbackUnlock(score);
        }

        msg.style.display = "none";
        successBox.style.display = "block";
        successBox.scrollIntoView({ behavior:"smooth", block:"start" });
      });
    })();
  </script>
</body>
</html>
